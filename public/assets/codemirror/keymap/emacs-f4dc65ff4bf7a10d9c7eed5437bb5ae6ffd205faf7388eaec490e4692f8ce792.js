// CodeMirror, copyright (c) by Marijn Haverbeke and others
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t){return e.line==t.line&&e.ch==t.ch}function n(e){E.push(e),E.length>50&&E.shift()}function r(e){if(!E.length)return n(e);E[E.length-1]+=e}function a(e){return E[E.length-(e?Math.min(e,1):1)]||""}function o(){return E.length>1&&E.pop(),a()}function i(e,a,o,i,l){null==l&&(l=e.getRange(a,o)),"grow"==i&&K&&K.cm==e&&t(a,K.pos)&&e.isClean(K.gen)?r(l):!1!==i&&n(l),e.replaceRange("",a,o,"+delete"),K="grow"==i?{cm:e,pos:a,gen:e.changeGeneration()}:null}function l(e,t,n){return e.findPosH(t,n,"char",!0)}function c(e,t,n){return e.findPosH(t,n,"word",!0)}function u(e,t,n){return e.findPosV(t,n,"line",e.doc.sel.goalColumn)}function s(e,t,n){return e.findPosV(t,n,"page",e.doc.sel.goalColumn)}function d(e,t,n){for(var r=t.line,a=e.getLine(r),o=/\S/.test(n<0?a.slice(0,t.ch):a.slice(t.ch)),i=e.firstLine(),l=e.lastLine();;){if((r+=n)<i||r>l)return e.clipPos(D(r-n,n<0?0:null));a=e.getLine(r);if(/\S/.test(a))o=!0;else if(o)return D(r,0)}}function f(e,t,n){for(var r=t.line,a=t.ch,o=e.getLine(t.line),i=!1;;){var l=o.charAt(a+(n<0?-1:0));if(l){if(i&&/[!?.]/.test(l))return D(r,a+(n>0?1:0));i||(i=/\w/.test(l)),a+=n}else{if(r==(n<0?e.firstLine():e.lastLine()))return D(r,a);if(o=e.getLine(r+n),!/\S/.test(o))return D(r,a);r+=n,a=n<0?o.length:0}}}function p(e,n,r){var a;if(e.findMatchingBracket&&(a=e.findMatchingBracket(n,{strict:!0}))&&a.match&&(a.forward?1:-1)==r)return r>0?D(a.to.line,a.to.ch+1):a.to;for(var o=!0;;o=!1){var i=e.getTokenAt(n),l=D(n.line,r<0?i.start:i.end);if(!(o&&r>0&&i.end==n.ch)&&/\w/.test(i.string))return l;var c=e.findPosH(l,r,"char");if(t(l,c))return n;n=c}}function g(e,t){var n=e.state.emacsPrefix;return n?(b(e),"-"==n?-1:Number(n)):t?null:1}function C(e){var t="string"==typeof e?function(t){t.execCommand(e)}:e;return function(e){var n=g(e);t(e);for(var r=1;r<n;++r)t(e)}}function h(e,n,r,a){var o=g(e);o<0&&(a=-a,o=-o);for(var i=0;i<o;++i){var l=r(e,n,a);if(t(l,n))break;n=l}return n}function w(e,t){var n=function(n){n.extendSelection(h(n,n.getCursor(),e,t))};return n.motion=!0,n}function m(e,t,n,r){for(var a,o=e.listSelections(),l=o.length;l--;)i(e,a=o[l].head,h(e,a,t,n),r)}function k(e,t){if(e.somethingSelected()){for(var n,r=e.listSelections(),a=r.length;a--;)i(e,(n=r[a]).anchor,n.head,t);return!0}}function S(e,t){e.state.emacsPrefix?"-"!=t&&(e.state.emacsPrefix+=t):(e.state.emacsPrefix=t,e.on("keyHandled",A),e.on("inputRead",v))}function A(e,t){e.state.emacsPrefixMap||X.hasOwnProperty(t)||b(e)}function b(e){e.state.emacsPrefix=null,e.off("keyHandled",A),e.off("inputRead",v)}function v(e,t){var n=g(e);if(n>1&&"+input"==t.origin){for(var r=t.text.join("\n"),a="",o=1;o<n;++o)a+=r;e.replaceSelection(a)}}function x(e,t){("string"!=typeof t||!/^\d$/.test(t)&&"Ctrl-U"!=t)&&(e.removeKeyMap(H),e.state.emacsPrefixMap=!1,e.off("keyHandled",x),e.off("inputRead",x))}function L(e){e.setExtending(!1),e.setCursor(e.getCursor())}function P(e){var t=document.createDocumentFragment(),n=document.createElement("input");return n.setAttribute("type","text"),n.style.width="10em",t.appendChild(document.createTextNode(e+": ")),t.appendChild(n),t}function R(e,t,n){e.openDialog?e.openDialog(P(t),n,{bottom:!0}):n(prompt(t,""))}function y(e,t){var n=e.getCursor(),r=e.findPosH(n,1,"word");e.replaceRange(t(e.getRange(n,r)),n,r),e.setCursor(r)}function W(e){for(var t=e.getCursor(),n=t.line,r=t.ch,a=[];n>=e.firstLine();){for(var o=e.getLine(n),i=null==r?o.length:r;i>0;){if(")"==(r=o.charAt(--i)))a.push("(");else if("]"==r)a.push("[");else if("}"==r)a.push("{");else if(/[\(\{\[]/.test(r)&&(!a.length||a.pop()!=r))return e.extendSelection(D(n,i))}--n,r=null}}function U(e){H[e]=function(t){S(t,e)},B["Ctrl-"+e]=function(t){S(t,e)},X["Ctrl-"+e]=!0}var M=e.commands,D=e.Pos,E=[],K=null,X={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};M.setMark=function(e){e.setCursor(e.getCursor()),e.setExtending(!e.getExtending()),e.on("change",function(){e.setExtending(!1)})},M.killRegion=function(e){i(e,e.getCursor("start"),e.getCursor("end"),!0)},M.killLineEmacs=C(function(e){var t=e.getCursor(),n=e.clipPos(D(t.line)),r=e.getRange(t,n);/\S/.test(r)||(r+="\n",n=D(t.line+1,0)),i(e,t,n,"grow",r)}),M.killRingSave=function(e){n(e.getSelection()),L(e)},M.yank=function(e){var t=e.getCursor();e.replaceRange(a(g(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},M.yankPop=function(e){e.replaceSelection(o(),"around","paste")},M.forwardChar=w(l,1),M.backwardChar=w(l,-1),M.deleteChar=function(e){m(e,l,1,!1)},M.deleteForwardChar=function(e){k(e,!1)||m(e,l,1,!1)},M.deleteBackwardChar=function(e){k(e,!1)||m(e,l,-1,!1)},M.forwardWord=w(c,1),M.backwardWord=w(c,-1),M.killWord=function(e){m(e,c,1,"grow")},M.backwardKillWord=function(e){m(e,c,-1,"grow")},M.nextLine=w(u,1),M.previousLine=w(u,-1),M.scrollDownCommand=w(s,1),M.scrollUpCommand=w(s,-1),M.backwardParagraph=w(d,-1),M.forwardParagraph=w(d,1),M.backwardSentence=w(f,-1),M.forwardSentence=w(f,1),M.killSentence=function(e){m(e,f,1,"grow")},M.backwardKillSentence=function(e){i(e,e.getCursor(),f(e,e.getCursor(),1),"grow")},M.killSexp=function(e){m(e,p,1,"grow")},M.backwardKillSexp=function(e){m(e,p,-1,"grow")},M.forwardSexp=w(p,1),M.backwardSexp=w(p,-1),M.markSexp=function(e){var t=e.getCursor();e.setSelection(h(e,t,p,1),t)},M.transposeSexps=function(e){var t=p(e,e.getCursor(),-1),n=p(e,t,1),r=p(e,n,1),a=p(e,r,-1);e.replaceRange(e.getRange(a,r)+e.getRange(n,a)+e.getRange(t,n),t,r)},M.backwardUpList=C(W),M.justOneSpace=function(e){for(var t=e.getCursor(),n=t.ch,r=t.ch,a=e.getLine(t.line);n&&/\s/.test(a.charAt(n-1));)--n;for(;r<a.length&&/\s/.test(a.charAt(r));)++r;e.replaceRange(" ",D(t.line,n),D(t.line,r))},M.openLine=C(function(e){e.replaceSelection("\n","start")}),M.transposeCharsRepeatable=C(function(e){e.execCommand("transposeChars")}),M.capitalizeWord=C(function(e){y(e,function(e){var t=e.search(/\w/);return-1==t?e:e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()})}),M.upcaseWord=C(function(e){y(e,function(e){return e.toUpperCase()})}),M.downcaseWord=C(function(e){y(e,function(e){return e.toLowerCase()})}),M.undoRepeatable=C("undo"),M.keyboardQuit=function(e){e.execCommand("clearSearch"),L(e)},M.newline=C(function(e){e.replaceSelection("\n","end")}),M.gotoLine=function(e){var t=g(e,!0);if(null!=t&&t>0)return e.setCursor(t-1);R(e,"Goto line",function(t){var n;t&&!isNaN(n=Number(t))&&n==(0|n)&&n>0&&e.setCursor(n-1)})},M.indentRigidly=function(e){e.indentSelection(g(e,!0)||e.getOption("indentUnit"))},M.exchangePointAndMark=function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},M.quotedInsertTab=C("insertTab"),M.universalArgument=function(e){e.state.emacsPrefixMap=!0,e.addKeyMap(H),e.on("keyHandled",x),e.on("inputRead",x)},e.emacs={kill:i,killRegion:k,repeated:C};for(var B=e.keyMap.emacs=e.normalizeKeyMap({"Ctrl-W":"killRegion","Ctrl-K":"killLineEmacs","Alt-W":"killRingSave","Ctrl-Y":"yank","Alt-Y":"yankPop","Ctrl-Space":"setMark","Ctrl-Shift-2":"setMark","Ctrl-F":"forwardChar","Ctrl-B":"backwardChar",Right:"forwardChar",Left:"backwardChar","Ctrl-D":"deleteChar",Delete:"deleteForwardChar","Ctrl-H":"deleteBackwardChar",Backspace:"deleteBackwardChar","Alt-F":"forwardWord","Alt-B":"backwardWord","Alt-Right":"forwardWord","Alt-Left":"backwardWord","Alt-D":"killWord","Alt-Backspace":"backwardKillWord","Ctrl-N":"nextLine","Ctrl-P":"previousLine",Down:"nextLine",Up:"previousLine","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":"scrollDownCommand","Ctrl-V":"scrollUpCommand",PageUp:"scrollUpCommand",PageDown:"scrollDownCommand","Ctrl-Up":"backwardParagraph","Ctrl-Down":"forwardParagraph","Alt-{":"backwardParagraph","Alt-}":"forwardParagraph","Alt-A":"backwardSentence","Alt-E":"forwardSentence","Alt-K":"killSentence","Ctrl-X Delete":"backwardKillSentence","Ctrl-Alt-K":"killSexp","Ctrl-Alt-Backspace":"backwardKillSexp","Ctrl-Alt-F":"forwardSexp","Ctrl-Alt-B":"backwardSexp","Shift-Ctrl-Alt-2":"markSexp","Ctrl-Alt-T":"transposeSexps","Ctrl-Alt-U":"backwardUpList","Alt-Space":"justOneSpace","Ctrl-O":"openLine","Ctrl-T":"transposeCharsRepeatable","Alt-C":"capitalizeWord","Alt-U":"upcaseWord","Alt-L":"downcaseWord","Alt-;":"toggleComment","Ctrl-/":"undoRepeatable","Shift-Ctrl--":"undoRepeatable","Ctrl-Z":"undoRepeatable","Cmd-Z":"undoRepeatable","Ctrl-X U":"undoRepeatable","Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":"keyboardQuit","Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":"newline",Tab:"indentAuto","Alt-G G":"gotoLine","Ctrl-X Tab":"indentRigidly","Ctrl-X Ctrl-X":"exchangePointAndMark","Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X K":"close","Ctrl-X H":"selectAll","Ctrl-Q Tab":"quotedInsertTab","Ctrl-U":"universalArgument",fallthrough:"default"}),H={"Ctrl-G":b},T=0;T<10;++T)U(String(T));U("-")});