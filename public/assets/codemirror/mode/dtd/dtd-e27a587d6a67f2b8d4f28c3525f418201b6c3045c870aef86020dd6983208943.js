// CodeMirror, copyright (c) by Marijn Haverbeke and others
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("dtd",function(t){function e(t,e){return u=e,t}function n(t,n){var u=t.next();if("<"!=u||!t.eat("!")){if("<"==u&&t.eat("?"))return n.tokenize=a("meta","?>"),e("meta",u);if("#"==u&&t.eatWhile(/[\w]/))return e("atom","tag");if("|"==u)return e("keyword","separator");if(u.match(/[\(\)\[\]\-\.,\+\?>]/))return e(null,u);if(u.match(/[\[\]]/))return e("rule",u);if('"'==u||"'"==u)return n.tokenize=i(u),n.tokenize(t,n);if(t.eatWhile(/[a-zA-Z\?\+\d]/)){var o=t.current();return null!==o.substr(o.length-1,o.length).match(/\?|\+/)&&t.backUp(1),e("tag","tag")}return"%"==u||"*"==u?e("number","number"):(t.eatWhile(/[\w\\\-_%.{,]/),e(null,null))}return t.eatWhile(/[\-]/)?(n.tokenize=r,r(t,n)):t.eatWhile(/[\w]/)?e("keyword","doindent"):void 0}function r(t,r){for(var i,a=0;null!=(i=t.next());){if(a>=2&&">"==i){r.tokenize=n;break}a="-"==i?a+1:0}return e("comment","comment")}function i(t){return function(r,i){for(var a,u=!1;null!=(a=r.next());){if(a==t&&!u){i.tokenize=n;break}u=!u&&"\\"==a}return e("string","tag")}}function a(t,e){return function(r,i){for(;!r.eol();){if(r.match(e)){i.tokenize=n;break}r.next()}return t}}var u,o=t.indentUnit;return{startState:function(t){return{tokenize:n,baseIndent:t||0,stack:[]}},token:function(t,e){if(t.eatSpace())return null;var n=e.tokenize(t,e),r=e.stack[e.stack.length-1];return"["==t.current()||"doindent"===u||"["==u?e.stack.push("rule"):"endtag"===u?e.stack[e.stack.length-1]="endtag":"]"==t.current()||"]"==u||">"==u&&"rule"==r?e.stack.pop():"["==u&&e.stack.push("["),n},indent:function(t,e){var n=t.stack.length;return"]"===e.charAt(0)?n--:">"===e.substr(e.length-1,e.length)&&("<"===e.substr(0,1)||"doindent"==u&&e.length>1||("doindent"==u?n--:">"==u&&e.length>1||"tag"==u&&">"!==e||("tag"==u&&"rule"==t.stack[t.stack.length-1]?n--:"tag"==u?n++:">"===e&&"rule"==t.stack[t.stack.length-1]&&">"===u?n--:">"===e&&"rule"==t.stack[t.stack.length-1]||("<"!==e.substr(0,1)&&">"===e.substr(0,1)?n-=1:">"===e||(n-=1)))),null!=u&&"]"!=u||n--),t.baseIndent+n*o},electricChars:"]>"}}),t.defineMIME("application/xml-dtd","dtd")});