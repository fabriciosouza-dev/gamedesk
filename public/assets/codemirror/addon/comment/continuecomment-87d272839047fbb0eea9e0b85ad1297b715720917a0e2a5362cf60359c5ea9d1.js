// CodeMirror, copyright (c) by Marijn Haverbeke and others
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(n){if(n.getOption("disableInput"))return e.Pass;for(var i,r=n.listSelections(),c=[],f=0;f<r.length;f++){var a=r[f].head;if(!/\bcomment\b/.test(n.getTokenTypeAt(a)))return e.Pass;var m=n.getModeAt(a);if(i){if(i!=m)return e.Pass}else i=m;var s,u,d=null,p=i.blockCommentStart,h=i.lineComment;if(p&&i.blockCommentContinue){var b=(s=n.getLine(a.line)).lastIndexOf(i.blockCommentEnd,a.ch-i.blockCommentEnd.length);if(-1!=b&&b==a.ch-i.blockCommentEnd.length||h&&(u=s.lastIndexOf(h,a.ch-1))>-1&&/\bcomment\b/.test(n.getTokenTypeAt({line:a.line,ch:u+1})));else if(a.ch>=p.length&&(u=s.lastIndexOf(p,a.ch-p.length))>-1&&u>b)if(t(0,s)>=u)d=s.slice(0,u);else{var g,C=n.options.tabSize;u=e.countColumn(s,u,C),d=n.options.indentWithTabs?l.call("\t",g=Math.floor(u/C))+l.call(" ",u-C*g):l.call(" ",u)}else(u=s.indexOf(i.blockCommentContinue))>-1&&u<=a.ch&&u<=t(0,s)&&(d=s.slice(0,u));null!=d&&(d+=i.blockCommentContinue)}if(null==d&&h&&o(n))if(null==s&&(s=n.getLine(a.line)),u=s.indexOf(h),a.ch||u){if(u>-1&&t(0,s)>=u){if(!(d=t(a.ch,s)>-1)){var v=n.getLine(a.line+1)||"",y=v.indexOf(h);d=y>-1&&t(0,v)>=y||null}d&&(d=s.slice(0,u)+h+s.slice(u+h.length).match(/^\s*/)[0])}}else d="";if(null==d)return e.Pass;c[f]="\n"+d}n.operation(function(){for(var e=r.length-1;e>=0;e--)n.replaceRange(c[e],r[e].from(),r[e].to(),"+insert")})}function t(e,n){i.lastIndex=e;var t=i.exec(n);return t?t.index:-1}function o(e){var n=e.getOption("continueComments");return!n||"object"!=typeof n||!1!==n.continueLineComment}var i=/\S/g,l=String.prototype.repeat||function(e){return Array(e+1).join(this)};e.defineOption("continueComments",null,function(t,o,i){if(i&&i!=e.Init&&t.removeKeyMap("continueComment"),o){var l="Enter";"string"==typeof o?l=o:"object"==typeof o&&o.key&&(l=o.key);var r={name:"continueComment"};r[l]=n,t.addKeyMap(r)}})});