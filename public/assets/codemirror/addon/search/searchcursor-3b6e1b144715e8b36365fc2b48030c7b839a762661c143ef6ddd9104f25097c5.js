// CodeMirror, copyright (c) by Marijn Haverbeke and others
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function n(t){var n=t.flags;return null!=n?n:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}function e(t,e){for(var r=n(t),i=r,o=0;o<e.length;o++)-1==i.indexOf(e.charAt(o))&&(i+=e.charAt(o));return r==i?t:new RegExp(t.source,i)}function r(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function i(t,n,r){n=e(n,"g");for(var i=r.line,o=r.ch,l=t.lastLine();i<=l;i++,o=0){n.lastIndex=o;var h=t.getLine(i),s=n.exec(h);if(s)return{from:d(i,s.index),to:d(i,s.index+s[0].length),match:s}}}function o(t,n,o){if(!r(n))return i(t,n,o);n=e(n,"gm");for(var l,h=1,s=o.line,f=t.lastLine();s<=f;){for(var c=0;c<h&&!(s>f);c++){var u=t.getLine(s++);l=null==l?u:l+"\n"+u}h*=2,n.lastIndex=o.ch;var a=n.exec(l);if(a){var g=l.slice(0,a.index).split("\n"),m=a[0].split("\n"),v=o.line+g.length-1,p=g[g.length-1].length;return{from:d(v,p),to:d(v+m.length-1,1==m.length?p+m[0].length:m[m.length-1].length),match:a}}}}function l(t,n,e){for(var r,i=0;i<=t.length;){n.lastIndex=i;var o=n.exec(t);if(!o)break;var l=o.index+o[0].length;if(l>t.length-e)break;(!r||l>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function h(t,n,r){n=e(n,"g");for(var i=r.line,o=r.ch,h=t.firstLine();i>=h;i--,o=-1){var s=t.getLine(i),f=l(s,n,o<0?0:s.length-o);if(f)return{from:d(i,f.index),to:d(i,f.index+f[0].length),match:f}}}function s(t,n,i){if(!r(n))return h(t,n,i);n=e(n,"gm");for(var o,s=1,f=t.getLine(i.line).length-i.ch,c=i.line,u=t.firstLine();c>=u;){for(var a=0;a<s&&c>=u;a++){var g=t.getLine(c--);o=null==o?g:g+"\n"+o}s*=2;var m=l(o,n,f);if(m){var v=o.slice(0,m.index).split("\n"),p=m[0].split("\n"),x=c+v.length,L=v[v.length-1].length;return{from:d(x,L),to:d(x+p.length-1,1==p.length?L+p[0].length:p[p.length-1].length),match:m}}}}function f(t,n,e,r){if(t.length==n.length)return e;for(var i=0,o=e+Math.max(0,t.length-n.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==e)return l;h>e?o=l:i=l+1}}function c(t,n,e,r){if(!n.length)return null;var i=r?g:m,o=i(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.lastLine()+1-o.length;l<=s;l++,h=0){var c=t.getLine(l).slice(h),u=i(c);if(1==o.length){var a=u.indexOf(o[0]);if(-1==a)continue t;e=f(c,u,a,i)+h;return{from:d(l,f(c,u,a,i)+h),to:d(l,f(c,u,a+o[0].length,i)+h)}}var v=u.length-o[0].length;if(u.slice(v)==o[0]){for(var p=1;p<o.length-1;p++)if(i(t.getLine(l+p))!=o[p])continue t;var x=t.getLine(l+o.length-1),L=i(x),C=o[o.length-1];if(L.slice(0,C.length)==C)return{from:d(l,f(c,u,v,i)+h),to:d(l+o.length-1,f(x,L,C.length,i))}}}}function u(t,n,e,r){if(!n.length)return null;var i=r?g:m,o=i(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.firstLine()-1+o.length;l>=s;l--,h=-1){var c=t.getLine(l);h>-1&&(c=c.slice(0,h));var u=i(c);if(1==o.length){var a=u.lastIndexOf(o[0]);if(-1==a)continue t;return{from:d(l,f(c,u,a,i)),to:d(l,f(c,u,a+o[0].length,i))}}var v=o[o.length-1];if(u.slice(0,v.length)==v){var p=1;for(e=l-o.length+1;p<o.length-1;p++)if(i(t.getLine(e+p))!=o[p])continue t;var x=t.getLine(l+1-o.length),L=i(x);if(L.slice(L.length-o[0].length)==o[0])return{from:d(l+1-o.length,f(x,L,x.length-o[0].length,i)),to:d(l,f(c,u,v.length,i))}}}}function a(t,n,r,l){this.atOccurrence=!1,this.doc=t,r=r?t.clipPos(r):d(0,0),this.pos={from:r,to:r};var f;"object"==typeof l?f=l.caseFold:(f=l,l=null),"string"==typeof n?(null==f&&(f=!1),this.matches=function(e,r){return(e?u:c)(t,n,r,f)}):(n=e(n,"gm"),l&&!1===l.multiline?this.matches=function(e,r){return(e?h:i)(t,n,r)}:this.matches=function(e,r){return(e?s:o)(t,n,r)})}var g,m,d=t.Pos;String.prototype.normalize?(g=function(t){return t.normalize("NFD").toLowerCase()},m=function(t){return t.normalize("NFD")}):(g=function(t){return t.toLowerCase()},m=function(t){return t}),a.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(n){for(var e=this.matches(n,this.doc.clipPos(n?this.pos.from:this.pos.to));e&&0==t.cmpPos(e.from,e.to);)n?e.from.ch?e.from=d(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(n,this.doc.clipPos(d(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=d(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(n,d(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var r=d(n?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:r,to:r},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,e){if(this.atOccurrence){var r=t.splitLines(n);this.doc.replaceRange(r,this.pos.from,this.pos.to,e),this.pos.to=d(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",function(t,n,e){return new a(this.doc,t,n,e)}),t.defineDocExtension("getSearchCursor",function(t,n,e){return new a(this,t,n,e)}),t.defineExtension("selectMatches",function(n,e){for(var r=[],i=this.getSearchCursor(n,this.getCursor("from"),e);i.findNext()&&!(t.cmpPos(i.to(),this.getCursor("to"))>0);)r.push({anchor:i.from(),head:i.to()});r.length&&this.setSelections(r,0)})});